<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>êµ¬ëª¬ìˆ˜í•™ ë‹¨ê³„ë³„ êµì¬ ë·°ì–´</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<style>
:root {
  --bg: #f0ede8;
  --stage-a: #e8401c;
  --stage-a-light: #fde8e3;
  --stage-a-mid: #f4a48e;
  --stage-b: #1a7fd4;
  --stage-b-light: #e0eefc;
  --stage-b-mid: #7ab8eb;
  --stage-c: #1aad6e;
  --stage-c-light: #dcf5eb;
  --stage-c-mid: #76d4a8;
  --ink: #1a1814;
  --ink-mid: #4a4540;
  --ink-light: #9a9088;
  --paper: #fffef9;
  --ui-bg: #ffffff;
  --ui-border: #e0dbd2;
  --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
  --shadow-md: 0 6px 24px rgba(0,0,0,0.12);
  --shadow-lg: 0 12px 48px rgba(0,0,0,0.18);
  --stage-color: var(--stage-a);
  --stage-light: var(--stage-a-light);
  --stage-mid: var(--stage-a-mid);
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Noto Sans KR', sans-serif;
  background: var(--bg);
  height: 100vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* â•â• QUICK MENU â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.quickmenu {
  height: 60px;
  background: var(--ui-bg);
  border-bottom: 1px solid var(--ui-border);
  box-shadow: var(--shadow-sm);
  display: flex;
  align-items: center;
  padding: 0 20px;
  gap: 0;
  flex-shrink: 0;
  z-index: 200;
}

.qm-logo {
  display: flex; align-items: center; gap: 10px;
  padding-right: 20px;
  border-right: 1px solid var(--ui-border);
  margin-right: 12px;
}
.qm-logo-icon {
  width: 36px; height: 36px; border-radius: 9px;
  background: var(--stage-color);
  display: flex; align-items: center; justify-content: center;
  color: white; font-weight: 700; font-size: 13px;
  transition: background 0.4s;
  font-family: 'DM Mono', monospace;
}
.qm-logo-name { font-size: 14px; font-weight: 700; color: var(--ink); line-height:1.2; }
.qm-logo-sub  { font-size: 10px; color: var(--ink-light); }

/* ë‹¨ê³„ íƒ­ */
.stage-tabs { display:flex; align-items:center; gap:4px; }

.stage-tab {
  display: flex; align-items: center; gap:8px;
  padding: 7px 16px; border-radius: 8px;
  cursor: pointer; border: 2px solid transparent;
  transition: all 0.2s; user-select: none;
}
.stage-tab-badge {
  width:28px; height:28px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  font-family:'DM Mono',monospace; font-size:13px; font-weight:600;
  transition: all 0.2s;
}
.stage-tab-name  { font-size:13px; font-weight:700; transition:color 0.2s; }
.stage-tab-sub   { font-size:10px; color:var(--ink-light); }

.stage-tab[data-s="A"] .stage-tab-badge { background:var(--stage-a-light); color:var(--stage-a); }
.stage-tab[data-s="A"]:hover            { background:var(--stage-a-light); }
.stage-tab[data-s="A"].on               { background:var(--stage-a-light); border-color:var(--stage-a); }
.stage-tab[data-s="A"].on .stage-tab-badge { background:var(--stage-a); color:white; }
.stage-tab[data-s="A"].on .stage-tab-name  { color:var(--stage-a); }

.stage-tab[data-s="B"] .stage-tab-badge { background:var(--stage-b-light); color:var(--stage-b); }
.stage-tab[data-s="B"]:hover            { background:var(--stage-b-light); }
.stage-tab[data-s="B"].on               { background:var(--stage-b-light); border-color:var(--stage-b); }
.stage-tab[data-s="B"].on .stage-tab-badge { background:var(--stage-b); color:white; }
.stage-tab[data-s="B"].on .stage-tab-name  { color:var(--stage-b); }

.stage-tab[data-s="C"] .stage-tab-badge { background:var(--stage-c-light); color:var(--stage-c); }
.stage-tab[data-s="C"]:hover            { background:var(--stage-c-light); }
.stage-tab[data-s="C"].on               { background:var(--stage-c-light); border-color:var(--stage-c); }
.stage-tab[data-s="C"].on .stage-tab-badge { background:var(--stage-c); color:white; }
.stage-tab[data-s="C"].on .stage-tab-name  { color:var(--stage-c); }

/* ì§„í–‰ë„ */
.qm-progress {
  display:flex; flex-direction:column; gap:5px;
  padding: 0 16px; border-left:1px solid var(--ui-border); margin-left:8px;
  min-width:130px;
}
.prog-row { display:flex; align-items:center; gap:6px; font-size:10px; color:var(--ink-light); font-family:'DM Mono',monospace; }
.prog-track { flex:1; height:4px; background:#e8e0d0; border-radius:2px; overflow:hidden; }
.prog-fill  { height:100%; border-radius:2px; transition:width 0.5s; }
.prog-fill.a { background:var(--stage-a); width:65%; }
.prog-fill.b { background:var(--stage-b); width:30%; }
.prog-fill.c { background:var(--stage-c); width:10%; }

/* ìš°ì¸¡ ì»¨íŠ¸ë¡¤ */
.qm-right { margin-left:auto; display:flex; align-items:center; gap:8px; }

.qm-btn {
  display:flex; align-items:center; gap:5px;
  padding:6px 12px; border-radius:6px;
  border:1px solid var(--ui-border); background:none;
  font-family:'Noto Sans KR',sans-serif; font-size:11px;
  color:var(--ink-mid); cursor:pointer; transition:all 0.15s; white-space:nowrap;
}
.qm-btn:hover { background:var(--bg); }

/* í˜ì´ì§€ ì í”„ */
.pj-wrap { position:relative; }
.pj-btn {
  display:flex; align-items:center; gap:6px;
  padding:6px 14px; border-radius:6px;
  border:2px solid var(--stage-color); background:none;
  font-family:'DM Mono',monospace; font-size:12px;
  color:var(--stage-color); cursor:pointer; transition:all 0.2s;
  min-width:88px; justify-content:center;
}
.pj-btn:hover { background:var(--stage-light); }

.pj-dropdown {
  position:absolute; top:calc(100% + 8px); right:0;
  background:var(--ui-bg); border:1px solid var(--ui-border);
  border-radius:12px; box-shadow:var(--shadow-lg);
  padding:12px; display:none;
  grid-template-columns:repeat(5,1fr); gap:4px;
  width:220px; z-index:500;
}
.pj-dropdown.open { display:grid; }
.pj-item {
  aspect-ratio:1; border-radius:6px;
  display:flex; align-items:center; justify-content:center;
  font-family:'DM Mono',monospace; font-size:11px;
  color:var(--ink-mid); cursor:pointer; transition:all 0.15s;
  border:1.5px solid transparent;
}
.pj-item:hover { background:var(--stage-light); color:var(--stage-color); border-color:var(--stage-mid); }
.pj-item.on    { background:var(--stage-color); color:white; }

/* â•â• TOOLBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toolbar {
  height: 44px; flex-shrink:0;
  background:var(--ui-bg); border-bottom:1px solid var(--ui-border);
  display:flex; align-items:center; padding:0 20px; gap:12px; z-index:150;
}
.tb-badge {
  display:flex; align-items:center; gap:6px;
  padding:4px 12px; border-radius:6px; background:var(--stage-light);
  font-size:12px; font-weight:700; color:var(--stage-color); transition:all 0.4s;
}
.tb-dot { width:7px; height:7px; border-radius:50%; background:var(--stage-color); transition:background 0.4s; }
.tb-sep { width:1px; height:20px; background:var(--ui-border); }
.tb-group { display:flex; align-items:center; gap:2px; }
.tb-btn {
  padding:4px 10px; border-radius:5px; border:1px solid transparent;
  background:none; font-family:'Noto Sans KR',sans-serif; font-size:11px;
  color:var(--ink-mid); cursor:pointer; transition:all 0.15s;
}
.tb-btn:hover { background:var(--bg); border-color:var(--ui-border); }
.tb-btn.on    { background:var(--stage-light); border-color:var(--stage-mid); color:var(--stage-color); }
.zoom-val {
  font-family:'DM Mono',monospace; font-size:11px;
  color:var(--stage-color); min-width:38px; text-align:center; transition:color 0.4s;
}
.tb-right { margin-left:auto; display:flex; align-items:center; gap:12px; }
.tb-info  { font-family:'DM Mono',monospace; font-size:11px; color:var(--ink-light); }

/* â•â• BODY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app-body {
  display:flex; flex:1; overflow:hidden;
}

/* â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar {
  width:200px; flex-shrink:0;
  background:var(--ui-bg); border-right:1px solid var(--ui-border);
  display:flex; flex-direction:column; overflow:hidden;
  transition:width 0.3s, opacity 0.3s;
}
.sidebar.hidden { width:0; opacity:0; pointer-events:none; }

.sb-head {
  padding:12px 14px 10px; border-bottom:1px solid var(--ui-border);
  display:flex; align-items:center; gap:7px; flex-shrink:0;
}
.sb-dot { width:8px; height:8px; border-radius:50%; background:var(--stage-color); transition:background 0.4s; flex-shrink:0; }
.sb-head-txt { font-size:10px; font-weight:700; letter-spacing:0.1em; text-transform:uppercase; color:var(--ink-light); white-space:nowrap; }

.sb-scroll {
  flex:1; overflow-y:auto; padding:10px 8px;
  display:flex; flex-direction:column; gap:5px;
  scrollbar-width:thin; scrollbar-color:var(--ui-border) transparent;
}

.thumb {
  display:flex; align-items:flex-start; gap:6px;
  cursor:pointer; padding:3px; border-radius:6px; transition:all 0.15s;
}
.thumb:hover { background:var(--bg); }
.thumb.on    { background:var(--stage-light); }
.thumb-num {
  font-family:'DM Mono',monospace; font-size:10px; color:var(--ink-light);
  min-width:18px; text-align:right; padding-top:3px; transition:color 0.15s; flex-shrink:0;
}
.thumb.on .thumb-num { color:var(--stage-color); font-weight:600; }

.thumb-canvas-wrap {
  flex:1; aspect-ratio:176/250;
  background:var(--paper); border-radius:2px;
  border:1.5px solid var(--ui-border); overflow:hidden;
  position:relative; transition:border-color 0.15s;
}
.thumb.on .thumb-canvas-wrap { border-color:var(--stage-color); }
.thumb-canvas-wrap canvas { width:100% !important; height:100% !important; display:block; }

/* ë¡œë”© í”Œë ˆì´ìŠ¤í™€ë” */
.thumb-placeholder {
  width:100%; height:100%;
  display:flex; align-items:center; justify-content:center;
  background: linear-gradient(90deg, #f0ede8 25%, #e8e4de 50%, #f0ede8 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  position:absolute; inset:0;
}
@keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }

/* â•â• VIEWER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.viewer {
  flex:1; overflow:auto; position:relative;
  scrollbar-width:thin; scrollbar-color:var(--ui-border) transparent;
  background:
    radial-gradient(ellipse at 20% 10%, rgba(200,169,110,0.04) 0%, transparent 55%),
    var(--bg);
}

.pages-wrap {
  display:flex; flex-direction:column; align-items:center;
  padding:40px 60px 80px;
  gap:32px;
  transform-origin:top center;
  transition:transform 0.2s;
}
.pages-wrap.double {
  flex-direction:row; flex-wrap:wrap; justify-content:center; align-items:flex-start;
}

/* â•â• B5 PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.b5-page {
  width: 176mm;
  flex-shrink:0; position:relative;
  background:var(--paper);
  border-radius:2px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08), 0 8px 24px rgba(0,0,0,0.12), 0 20px 56px rgba(0,0,0,0.1);
  overflow:hidden; transition:box-shadow 0.3s, transform 0.3s;
  animation: pageIn 0.4s ease both;
}
.b5-page:hover {
  box-shadow:0 4px 10px rgba(0,0,0,0.1), 0 12px 32px rgba(0,0,0,0.16), 0 28px 72px rgba(0,0,0,0.13);
  transform:translateY(-2px);
}
@keyframes pageIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

.page-top-bar { height:5px; background:var(--stage-color); transition:background 0.4s; }

/* PDF ìº”ë²„ìŠ¤ */
.pdf-canvas-wrap {
  width:176mm; position:relative;
  background:var(--paper);
}
.pdf-canvas-wrap canvas {
  display:block; width:100% !important;
}

/* ë¡œë”© ìƒíƒœ */
.page-loading {
  width:176mm; height:250mm;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center; gap:16px;
  background:var(--paper);
}
.spinner {
  width:36px; height:36px; border-radius:50%;
  border:3px solid var(--stage-light);
  border-top-color:var(--stage-color);
  animation:spin 0.8s linear infinite;
}
@keyframes spin { to{transform:rotate(360deg)} }
.loading-txt { font-size:11px; color:var(--ink-light); font-family:'DM Mono',monospace; }

/* ì—ëŸ¬ ìƒíƒœ */
.page-error {
  width:176mm; height:250mm;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center; gap:12px;
  background:var(--paper);
}
.error-icon { font-size:32px; opacity:0.4; }
.error-txt  { font-size:11px; color:var(--ink-light); text-align:center; line-height:1.6; }

/* â•â• STATUS BAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.statusbar {
  height:26px; flex-shrink:0;
  background:var(--ui-bg); border-top:1px solid var(--ui-border);
  display:flex; align-items:center; padding:0 20px; gap:20px;
  font-size:10px; color:var(--ink-light); font-family:'DM Mono',monospace; z-index:100;
}
.st-item { display:flex; gap:5px; }
.st-k { color:var(--ink-light); }
.st-v { color:var(--stage-color); transition:color 0.4s; }

/* ë‹¨ê³„ ì „í™˜ ì˜¤ë²„ë ˆì´ */
.stage-overlay {
  position:fixed; inset:0; z-index:1000;
  display:flex; align-items:center; justify-content:center;
  pointer-events:none; opacity:0; transition:opacity 0.25s;
  background:rgba(0,0,0,0.35);
}
.stage-overlay.show { opacity:1; }
.stage-overlay-box {
  padding:20px 48px; border-radius:16px;
  font-size:44px; font-weight:900; color:white;
  background:var(--stage-color); box-shadow:var(--shadow-lg);
  transition:background 0.4s; letter-spacing:0.08em;
}

/* ë°˜ì‘í˜• */
@media(max-width:900px){
  .sidebar{display:none}
  .qm-progress{display:none}
  .b5-page,.pdf-canvas-wrap,.page-loading,.page-error{width:90vw}
  .pages-wrap{padding:20px 10px 60px}
}
@media(max-width:600px){
  .stage-tab-sub{display:none}
  .qm-logo-name{display:none}
}
</style>
</head>
<body>

<!-- ë‹¨ê³„ ì „í™˜ ì˜¤ë²„ë ˆì´ -->
<div class="stage-overlay" id="overlay">
  <div class="stage-overlay-box" id="overlay-txt">Aë‹¨ê³„</div>
</div>

<!-- â•â• QUICK MENU â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="quickmenu">
  <div class="qm-logo">
    <div class="qm-logo-icon" id="logo-icon">ìˆ˜í•™</div>
    <div>
      <div class="qm-logo-name">êµ¬ëª¬ìˆ˜í•™</div>
      <div class="qm-logo-sub">ë‹¨ê³„ë³„ êµì¬ ë·°ì–´</div>
    </div>
  </div>

  <div class="stage-tabs">
    <div class="stage-tab on" data-s="A" onclick="switchStage('A')">
      <div class="stage-tab-badge">A</div>
      <div><div class="stage-tab-name">Aë‹¨ê³„</div><div class="stage-tab-sub">ê¸°ì´ˆ ì—°ì‚°</div></div>
    </div>
    <div class="stage-tab" data-s="B" onclick="switchStage('B')">
      <div class="stage-tab-badge">B</div>
      <div><div class="stage-tab-name">Bë‹¨ê³„</div><div class="stage-tab-sub">ì‚¬ì¹™ì—°ì‚°</div></div>
    </div>
    <div class="stage-tab" data-s="C" onclick="switchStage('C')">
      <div class="stage-tab-badge">C</div>
      <div><div class="stage-tab-name">Cë‹¨ê³„</div><div class="stage-tab-sub">ë¶„ìˆ˜Â·ì†Œìˆ˜</div></div>
    </div>
  </div>

  <div class="qm-progress">
    <div class="prog-row"><span style="color:var(--stage-a);font-weight:700;min-width:14px">A</span><div class="prog-track"><div class="prog-fill a"></div></div><span>65%</span></div>
    <div class="prog-row"><span style="color:var(--stage-b);font-weight:700;min-width:14px">B</span><div class="prog-track"><div class="prog-fill b"></div></div><span>30%</span></div>
    <div class="prog-row"><span style="color:var(--stage-c);font-weight:700;min-width:14px">C</span><div class="prog-track"><div class="prog-fill c"></div></div><span>10%</span></div>
  </div>

  <div class="qm-right">
    <button class="qm-btn" onclick="toggleSidebar()">
      <svg width="13" height="13" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="1" y="1" width="14" height="14" rx="2"/><line x1="5" y1="1" x2="5" y2="15"/></svg>
      ëª©ë¡
    </button>

    <div class="pj-wrap">
      <button class="pj-btn" id="pj-btn" onclick="togglePJ()">
        <svg width="12" height="12" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="2" y="2" width="5" height="5" rx="1"/><rect x="9" y="2" width="5" height="5" rx="1"/><rect x="2" y="9" width="5" height="5" rx="1"/><rect x="9" y="9" width="5" height="5" rx="1"/></svg>
        <span id="pj-label">1 / 10</span>
      </button>
      <div class="pj-dropdown" id="pj-dd"></div>
    </div>
  </div>
</nav>

<!-- â•â• TOOLBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="toolbar">
  <div class="tb-badge" id="tb-badge">
    <div class="tb-dot"></div>
    <span id="tb-label">Aë‹¨ê³„ Â· ê¸°ì´ˆ ì—°ì‚°</span>
  </div>
  <div class="tb-sep"></div>
  <div class="tb-group">
    <button class="tb-btn" onclick="chZoom(-10)">âˆ’</button>
    <span class="zoom-val" id="zoom-val">100%</span>
    <button class="tb-btn" onclick="chZoom(10)">+</button>
    <button class="tb-btn" onclick="resetZoom()">ë§ì¶¤</button>
  </div>
  <div class="tb-sep"></div>
  <div class="tb-group">
    <button class="tb-btn on" id="btn-single" onclick="setLayout('single')">ë‹¨ë©´</button>
    <button class="tb-btn"    id="btn-double" onclick="setLayout('double')">ì–‘ë©´</button>
  </div>
  <div class="tb-right">
    <span class="tb-info" id="tb-info">1 / 10 Â· B5 176Ã—250mm</span>
  </div>
</div>

<!-- â•â• BODY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="app-body">
  <aside class="sidebar" id="sidebar">
    <div class="sb-head">
      <div class="sb-dot" id="sb-dot"></div>
      <span class="sb-head-txt" id="sb-title">Aë‹¨ê³„ í˜ì´ì§€</span>
    </div>
    <div class="sb-scroll" id="thumb-list"></div>
  </aside>

  <div class="viewer" id="viewer">
    <div class="pages-wrap" id="pages-wrap"></div>
  </div>
</div>

<!-- â•â• STATUS BAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="statusbar">
  <div class="st-item"><span class="st-k">ë‹¨ê³„</span><span class="st-v" id="st-stage">Aë‹¨ê³„</span></div>
  <div class="st-item"><span class="st-k">í˜ì´ì§€</span><span class="st-v" id="st-page">1/10</span></div>
  <div class="st-item"><span class="st-k">í™•ëŒ€</span><span class="st-v" id="st-zoom">100%</span></div>
  <div class="st-item"><span class="st-k">ë ˆì´ì•„ì›ƒ</span><span class="st-v" id="st-layout">ë‹¨ë©´</span></div>
  <div class="st-item"><span class="st-k">PDF</span><span class="st-v" id="st-pdf">ë¡œë”©ì¤‘...</span></div>
</div>

<script>
// PDF.js worker ì„¤ì •
pdfjsLib.GlobalWorkerOptions.workerSrc =
  'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì„¤ì •
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STAGE_CFG = {
  A: { label:'Aë‹¨ê³„', sub:'ê¸°ì´ˆ ì—°ì‚°',  color:'#e8401c', light:'#fde8e3', mid:'#f4a48e', pdf:'êµ¬ëª¬ìˆ˜í•™Aë‹¨ê³„í…ŒìŠ¤íŠ¸10ì¥.pdf' },
  B: { label:'Bë‹¨ê³„', sub:'ì‚¬ì¹™ì—°ì‚°',   color:'#1a7fd4', light:'#e0eefc', mid:'#7ab8eb', pdf:'êµ¬ëª¬ìˆ˜í•™Bë‹¨ê³„í…ŒìŠ¤íŠ¸10ì¥.pdf' },
  C: { label:'Cë‹¨ê³„', sub:'ë¶„ìˆ˜Â·ì†Œìˆ˜',  color:'#1aad6e', light:'#dcf5eb', mid:'#76d4a8', pdf:'êµ¬ëª¬ìˆ˜í•™Cë‹¨ê³„í…ŒìŠ¤íŠ¸10ì¥.pdf' },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ìƒíƒœ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let curStage   = 'A';
let curPage    = 1;
let zoom       = 100;
let layout     = 'single';
let sidebarOn  = true;

// PDF ìºì‹œ: { A: pdfDoc, B: ..., C: ... }
const pdfCache = {};
// ì´ í˜ì´ì§€ìˆ˜ ìºì‹œ
const totalPages = { A:10, B:10, C:10 };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CSS ë³€ìˆ˜ ì ìš©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function applyColors(s) {
  const c = STAGE_CFG[s];
  const r = document.documentElement;
  r.style.setProperty('--stage-color', c.color);
  r.style.setProperty('--stage-light', c.light);
  r.style.setProperty('--stage-mid',   c.mid);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PDF ë¡œë“œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadPDF(stage) {
  if (pdfCache[stage]) return pdfCache[stage];
  const url = STAGE_CFG[stage].pdf;
  try {
    const doc = await pdfjsLib.getDocument(url).promise;
    pdfCache[stage] = doc;
    totalPages[stage] = doc.numPages;
    return doc;
  } catch(e) {
    console.error('PDF load error:', stage, e);
    return null;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë‹¨ì¼ í˜ì´ì§€ ë Œë” (Canvas)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderPDFPage(pdfDoc, pageNum, canvas) {
  try {
    const page = await pdfDoc.getPage(pageNum);
    // B5 = 176mm. 1mm â‰’ 3.7795px â†’ 176mm â‰’ 665px (96dpi ê¸°ì¤€)
    // PDFì˜ ê¸°ë³¸ ë‹¨ìœ„ëŠ” pt (72dpi), viewport scaleë¡œ ë§ì¶¤
    const TARGET_W = 665; // px (í‘œì‹œ ë„ˆë¹„)
    const vp0 = page.getViewport({ scale: 1 });
    const scale = TARGET_W / vp0.width;
    const viewport = page.getViewport({ scale });

    const ctx = canvas.getContext('2d');
    canvas.width  = viewport.width;
    canvas.height = viewport.height;

    await page.render({ canvasContext: ctx, viewport }).promise;
  } catch(e) {
    console.error('Page render error:', pageNum, e);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì¸ë„¤ì¼ ë Œë”
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderThumb(pdfDoc, pageNum, container) {
  container.innerHTML = '';
  if (!pdfDoc) return;
  try {
    const page = await pdfDoc.getPage(pageNum);
    const vp0  = page.getViewport({ scale:1 });
    const scale = 160 / vp0.width; // ì¸ë„¤ì¼ ë„ˆë¹„ 160px
    const vp   = page.getViewport({ scale });
    const canvas = document.createElement('canvas');
    canvas.width  = vp.width;
    canvas.height = vp.height;
    await page.render({ canvasContext: canvas.getContext('2d'), viewport: vp }).promise;
    container.appendChild(canvas);
  } catch(e) {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë©”ì¸ í˜ì´ì§€ ë Œë”ë§
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderAll() {
  const wrap = document.getElementById('pages-wrap');
  wrap.innerHTML = '';
  wrap.className = 'pages-wrap' + (layout === 'double' ? ' double' : '');

  const total = totalPages[curStage];

  // ë¡œë”© í˜ì´ì§€ ë¨¼ì € í‘œì‹œ
  for (let i = 1; i <= total; i++) {
    const pageDiv = document.createElement('div');
    pageDiv.className = 'b5-page';
    pageDiv.dataset.page = i;
    pageDiv.style.animationDelay = (i * 0.04) + 's';
    pageDiv.innerHTML = `
      <div class="page-top-bar"></div>
      <div class="page-loading" id="loading-${i}">
        <div class="spinner"></div>
        <div class="loading-txt">í˜ì´ì§€ ${i} ë¡œë”© ì¤‘...</div>
      </div>`;
    wrap.appendChild(pageDiv);
  }

  applyZoom();

  // PDF ë¡œë“œ & ë Œë”
  document.getElementById('st-pdf').textContent = 'ë¡œë”©ì¤‘...';
  const pdfDoc = await loadPDF(curStage);

  if (!pdfDoc) {
    // ì—ëŸ¬ í‘œì‹œ
    for (let i = 1; i <= total; i++) {
      const loading = document.getElementById(`loading-${i}`);
      if (loading) {
        loading.className = 'page-error';
        loading.innerHTML = `
          <div class="error-icon">ğŸ“„</div>
          <div class="error-txt">PDFë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>${STAGE_CFG[curStage].pdf}</div>`;
      }
    }
    document.getElementById('st-pdf').textContent = 'ì˜¤ë¥˜';
    return;
  }

  document.getElementById('st-pdf').textContent = `${pdfDoc.numPages}í˜ì´ì§€ ë¡œë“œë¨`;
  totalPages[curStage] = pdfDoc.numPages;

  // ê° í˜ì´ì§€ ë Œë” (ë¹„ë™ê¸° ë³‘ë ¬)
  const renderPromises = [];
  for (let i = 1; i <= pdfDoc.numPages; i++) {
    renderPromises.push((async (pageNum) => {
      const loading = document.getElementById(`loading-${pageNum}`);
      if (!loading) return;
      const parent = loading.parentElement;

      const canvas = document.createElement('canvas');
      const canvasWrap = document.createElement('div');
      canvasWrap.className = 'pdf-canvas-wrap';
      canvasWrap.appendChild(canvas);

      await renderPDFPage(pdfDoc, pageNum, canvas);

      parent.removeChild(loading);
      parent.appendChild(canvasWrap);
    })(i));
  }

  await Promise.all(renderPromises);

  // ì¸ë„¤ì¼ ë Œë”
  renderThumbs(pdfDoc);
  buildPJ();
  updateUI();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì¸ë„¤ì¼ ëª©ë¡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderThumbs(pdfDoc) {
  const list = document.getElementById('thumb-list');
  list.innerHTML = '';
  const total = pdfDoc ? pdfDoc.numPages : totalPages[curStage];

  for (let i = 1; i <= total; i++) {
    const div = document.createElement('div');
    div.className = 'thumb' + (i === curPage ? ' on' : '');
    div.dataset.page = i;
    div.onclick = () => goToPage(i);

    const canvasWrap = document.createElement('div');
    canvasWrap.className = 'thumb-canvas-wrap';
    canvasWrap.innerHTML = '<div class="thumb-placeholder"></div>';

    div.innerHTML = `<span class="thumb-num">${i}</span>`;
    div.appendChild(canvasWrap);
    list.appendChild(div);

    // ë¹„ë™ê¸° ì¸ë„¤ì¼ ë Œë”
    if (pdfDoc) {
      renderThumb(pdfDoc, i, canvasWrap);
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// í˜ì´ì§€ ì´ë™
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function goToPage(num) {
  curPage = num;
  const target = document.querySelector(`.b5-page[data-page="${num}"]`);
  if (target) {
    target.scrollIntoView({ behavior:'smooth', block:'start' });
  }
  updateUI();
  closePJ();
}

// ìŠ¤í¬ë¡¤ë¡œ í˜„ì¬ í˜ì´ì§€ ê°ì§€
document.getElementById('viewer').addEventListener('scroll', () => {
  const pages = document.querySelectorAll('.b5-page');
  let cur = 1;
  const scrollTop = document.getElementById('viewer').scrollTop + 120;
  pages.forEach(p => {
    if (p.offsetTop <= scrollTop) cur = parseInt(p.dataset.page);
  });
  if (cur !== curPage) {
    curPage = cur;
    updateUI();
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI ì—…ë°ì´íŠ¸
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateUI() {
  const total = totalPages[curStage];
  const c = STAGE_CFG[curStage];

  document.getElementById('pj-label').textContent  = `${curPage} / ${total}`;
  document.getElementById('tb-info').textContent    = `${curPage} / ${total} Â· B5 176Ã—250mm`;
  document.getElementById('st-page').textContent    = `${curPage}/${total}`;
  document.getElementById('st-stage').textContent   = c.label;

  // ì¸ë„¤ì¼ í™œì„±í™”
  document.querySelectorAll('.thumb').forEach(t => {
    t.classList.toggle('on', parseInt(t.dataset.page) === curPage);
  });
  // í˜ì´ì§€ ì í”„ í™œì„±í™”
  document.querySelectorAll('.pj-item').forEach(d => {
    d.classList.toggle('on', parseInt(d.textContent) === curPage);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë‹¨ê³„ ì „í™˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchStage(s) {
  if (s === curStage) return;
  curStage = s;
  curPage  = 1;
  const c  = STAGE_CFG[s];

  // ì˜¤ë²„ë ˆì´
  const ov = document.getElementById('overlay');
  document.getElementById('overlay-txt').textContent = c.label;
  ov.style.background = 'rgba(0,0,0,0.35)';
  document.getElementById('overlay-txt').style.background = c.color;
  ov.classList.add('show');
  setTimeout(() => ov.classList.remove('show'), 650);

  applyColors(s);

  // íƒ­ ì—…ë°ì´íŠ¸
  document.querySelectorAll('.stage-tab').forEach(t => t.classList.toggle('on', t.dataset.s === s));

  // ë¡œê³ Â·ë°°ì§€Â·ì‚¬ì´ë“œë°” í—¤ë” ì—…ë°ì´íŠ¸
  document.getElementById('logo-icon').textContent  = c.label.slice(0,2);
  document.getElementById('tb-label').textContent   = `${c.label} Â· ${c.sub}`;
  document.getElementById('sb-title').textContent   = `${c.label} í˜ì´ì§€`;
  document.getElementById('st-stage').textContent   = c.label;

  renderAll();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì¤Œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function chZoom(d)  { zoom = Math.max(50, Math.min(200, zoom+d)); applyZoom(); }
function resetZoom(){ zoom = 100; applyZoom(); }
function applyZoom(){
  const wrap = document.getElementById('pages-wrap');
  wrap.style.transform = `scale(${zoom/100})`;
  // ìŠ¤ì¼€ì¼ ë³´ì •
  const sh = wrap.scrollHeight;
  wrap.style.marginBottom = `${sh*(zoom/100 - 1)}px`;
  document.getElementById('zoom-val').textContent  = zoom + '%';
  document.getElementById('st-zoom').textContent   = zoom + '%';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë ˆì´ì•„ì›ƒ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setLayout(v) {
  layout = v;
  document.getElementById('btn-single').classList.toggle('on', v==='single');
  document.getElementById('btn-double').classList.toggle('on', v==='double');
  document.getElementById('st-layout').textContent = v==='single'?'ë‹¨ë©´':'ì–‘ë©´';
  document.getElementById('pages-wrap').className = 'pages-wrap' + (v==='double'?' double':'');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì‚¬ì´ë“œë°”
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleSidebar() {
  sidebarOn = !sidebarOn;
  document.getElementById('sidebar').classList.toggle('hidden', !sidebarOn);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// í˜ì´ì§€ ì í”„ ë“œë¡­ë‹¤ìš´
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildPJ() {
  const dd = document.getElementById('pj-dd');
  dd.innerHTML = '';
  const total = totalPages[curStage];
  for (let i = 1; i <= total; i++) {
    const d = document.createElement('div');
    d.className = 'pj-item' + (i===curPage?' on':'');
    d.textContent = i;
    d.onclick = () => goToPage(i);
    dd.appendChild(d);
  }
}
function togglePJ() { document.getElementById('pj-dd').classList.toggle('open'); }
function closePJ()  { document.getElementById('pj-dd').classList.remove('open'); }
document.addEventListener('click', e => { if (!e.target.closest('.pj-wrap')) closePJ(); });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì´ˆê¸°í™”
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
applyColors('A');
buildPJ();
renderAll();
</script>
</body>
</html>
